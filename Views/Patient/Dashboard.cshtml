@* @{
    ViewData["Title"] = "Patient Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container py-4">
    <h2 class="fw-bold mb-4">Patient Dashboard</h2>
    <p class="text-muted">Welcome back, @ViewBag.PatientName</p>

    <!-- Overview Summary Cards -->
    <div class="row g-4 mb-4">
        <!-- Appointments -->
        <div class="col-md-3">
            <div class="card shadow-sm border-0 rounded-4 text-center p-3">
                <div class="card-body">
                    <h6 class="text-muted">Upcoming Appointments</h6>
                    <h3>@ViewBag.UpcomingAppointmentsCount</h3>
                    <p class="small text-muted">Next: @ViewBag.NextAppointmentDate</p>
                </div>
            </div>
        </div>

        <!-- Medical Files -->
        <div class="col-md-3">
            <div class="card shadow-sm border-0 rounded-4 text-center p-3">
                <div class="card-body">
                    <h5 class="card-title text-primary fw-bold">My Medical Files</h5>
                    <p class="card-text">Upload or manage your medical files securely.</p>
                    <a asp-controller="MedicalFile" asp-action="Index" class="btn btn-outline-primary mb-2">Manage
                        Files</a>
                    <a href="/MedicalFile/index" class="btn btn-outline-info fw-semibold">Manage Now</a>
                </div>
            </div>
        </div>

        <!-- Prescriptions -->
        <div class="col-md-3">
            <div class="card shadow-sm border-0 rounded-4 text-center p-3">
                <div class="card-body">
                    <h6 class="text-muted">Prescriptions</h6>
                    <h3>@ViewBag.PrescriptionsCount</h3>
                    <p class="small text-muted">@ViewBag.ActivePrescriptionsCount active</p>
                </div>
            </div>
        </div>

        <!-- My Doctors -->
        <div class="col-md-3">
            <div class="card shadow-sm border-0 rounded-4 text-center p-3">
                <div class="card-body">
                    <h6 class="text-muted">My Doctors</h6>
                    <h3>@ViewBag.MyDoctorsCount</h3>
                    <p class="small text-muted">Primary care & specialists</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ðŸ”¹ New Find Doctor Card Row -->
    <div class="row g-4 mb-4">
        <div class="col-md-4">
            <div class="card shadow border-info border-2 rounded-4 text-center p-3 h-100">
                <div class="card-body">
                    <i class="fas fa-user-md fa-2x text-info mb-2"></i>
                    <h5 class="card-title text-info fw-bold">Find a Doctor</h5>
                    <p class="text-muted">Search doctors by specialty, location, or name to book an appointment.</p>
                    <a href="/Patient/BookAppointment" class="btn btn-outline-info fw-semibold">Search Now</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Medical Records + Appointments Preview -->
    <div class="row g-4">
        <!-- Recent Medical Records -->
        <div class="col-md-6">
            <div class="card shadow-sm border-0 rounded-4 h-100">
                <div class="card-body">
                    <h5 class="card-title mb-3">Recent Medical Records</h5>
                    @if (ViewBag.RecentMedicalRecords != null)
                    {
                        foreach (var record in ViewBag.RecentMedicalRecords)
                        {
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <div>
                                    <strong>@record.Description</strong><br />
                                    <small class="text-muted">@record.UploadedAt.ToShortDateString()</small>
                                </div>
                                <a href="/MedicalFile" class="btn btn-sm btn-outline-primary">View</a>

                            </div>
                        }
                    }
                    <a href="/MedicalFile" class="d-block mt-3 text-decoration-none">View all medical
                        records</a>
                </div>
            </div>
        </div>

        <!-- Upcoming Appointments -->
        <div class="col-md-6">
            <div class="card shadow-sm border-0 rounded-4 h-100">
                <div class="card-body">
                    <h5 class="card-title mb-3">Upcoming Appointments</h5>
                    @if (ViewBag.UpcomingAppointments != null)
                    {
                        foreach (var appt in ViewBag.UpcomingAppointments)
                        {
                            <div class="mb-3">
                                <strong>@appt.DoctorName</strong><br />
                                <small class="text-muted">@appt.AppointmentDate.ToString("f")</small><br />
                                <span class="badge bg-light text-dark">@appt.Specialization</span>
                                <div class="mt-2">
                                    <a href="#" class="btn btn-sm btn-outline-secondary">Reschedule</a>
                                </div>
                            </div>
                        }
                    }
                    <a href="/Patient/BookAppointment" class="btn btn-success mt-3 w-100">Schedule New Appointment</a>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
} *@


@{
    ViewData["Title"] = "Patient Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container py-4">
    <h2 class="fw-bold mb-4">Patient Dashboard</h2>
    <p class="text-muted">Welcome back, @ViewBag.PatientName</p>
    <!-- ðŸ”” Reminder Section -->

    @if (ViewBag.ReminderMessage != null)
    {
        <div class="alert alert-info alert-dismissible fade show rounded-3 fw-semibold" role="alert">
            @ViewBag.ReminderMessage
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <!-- Overview Summary Cards -->
    <div class="row g-4 mb-4">
        <!-- Appointments -->
        <div class="col-md-3">
            <div class="card shadow-sm border-0 rounded-4 text-center p-3">
                <div class="card-body">
                    <h6 class="text-muted">Upcoming Appointments</h6>
                    <h3>@ViewBag.UpcomingAppointmentsCount</h3>
                    <p class="small text-muted">Next: @ViewBag.NextAppointmentDate</p>
                </div>
            </div>
        </div>

        <!-- Medical Files -->
        <div class="col-md-3">
            <div class="card shadow-sm border-0 rounded-4 text-center p-3">
                <div class="card-body">
                    <h5 class="card-title text-primary fw-bold">My Medical Files</h5>
                    <p class="card-text">Upload or manage your medical files securely.</p>
                    <a asp-controller="MedicalFile" asp-action="Index" class="btn btn-outline-primary mb-2">Manage
                        Files</a>
                    <a href="/MedicalFile/index" class="btn btn-outline-info fw-semibold">Manage Now</a>
                </div>
            </div>
        </div>

        <!-- Prescriptions -->
        <div class="col-md-3">
            <div class="card shadow-sm border-0 rounded-4 text-center p-3">
                <div class="card-body">
                    <h6 class="text-muted">Prescriptions</h6>
                    <h3>@ViewBag.PrescriptionsCount</h3>
                    <p class="small text-muted">@ViewBag.ActivePrescriptionsCount active</p>
                </div>
            </div>
        </div>

        <!-- My Doctors -->
        <div class="col-md-3">
            <div class="card shadow-sm border-0 rounded-4 text-center p-3">
                <div class="card-body">
                    <h6 class="text-muted">My Doctors</h6>
                    <h3>@ViewBag.MyDoctorsCount</h3>
                    <p class="small text-muted">Primary care & specialists</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Find Doctor -->
    <div class="row g-4 mb-4">
        <div class="col-md-4">
            <div class="card shadow border-info border-2 rounded-4 text-center p-3 h-100">
                <div class="card-body">
                    <i class="fas fa-user-md fa-2x text-info mb-2"></i>
                    <h5 class="card-title text-info fw-bold">Find a Doctor</h5>
                    <p class="text-muted">Search doctors by specialty, location, or name to book an appointment.</p>
                    <a href="/Patient/BookAppointment" class="btn btn-outline-info fw-semibold">Search Now</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Medical Records + My Appointments -->
    <div class="row g-4">
        <!-- Recent Medical Records -->
        <div class="col-md-6">
            <div class="card shadow-sm border-0 rounded-4 h-100">
                <div class="card-body">
                    <h5 class="card-title mb-3">Recent Medical Records</h5>
                    @if (ViewBag.RecentMedicalRecords != null)
                    {
                        foreach (var record in ViewBag.RecentMedicalRecords)
                        {
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <div>
                                    <strong>@record.Description</strong><br />
                                    <small class="text-muted">@record.UploadedAt.ToShortDateString()</small>
                                </div>
                                <a href="/MedicalFile" class="btn btn-sm btn-outline-primary">View</a>
                            </div>
                        }
                    }
                    <a href="/MedicalFile" class="d-block mt-3 text-decoration-none">View all medical records</a>
                </div>
            </div>
        </div>



        <!-- My Appointments -->
        <div class="col-md-6">
            <div class="card shadow-sm border-0 rounded-4 h-100">
                <div class="card-body">
                    <h5 class="card-title mb-3">My Appointments</h5>
                    @if (ViewBag.UpcomingAppointments != null && ViewBag.UpcomingAppointments.Count > 0)
                    {
                        foreach (var appt in ViewBag.UpcomingAppointments)
                        {
                            <div class="mb-3">
                                <strong>@appt.DoctorName</strong><br />
                                <small class="text-muted">@appt.AppointmentDate.ToString("f")</small><br />
                                <span class="badge bg-light text-dark">@appt.Specialization</span>
                                <div class="mt-2">
                                    <a asp-controller="Appointment" asp-action="Unbook" asp-route-id="@appt.Id"
                                        class="btn btn-sm btn-outline-danger">Unbook</a>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <p class="text-muted">You have no upcoming appointments.</p>
                    }

                    <a href="/Patient/BookAppointment" class="btn btn-success mt-3 w-100">Schedule New Appointment</a>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
}
